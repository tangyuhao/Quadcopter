
普通情况：flag为0，该情况说明飞机没有执行自动飞行/起飞等自我执行的任务，控制权仍然在地面

***自动起飞相关***：
若判断不能起飞（如查询不到卫星或者飞机机身倾斜严重），则先发送一个flag为1的信息，然后再发送0，已告知地面站飞机拒绝自动起飞
起飞后：flag会先变成1，说明当前飞机正在自动起飞过程中，此时地面站并不能对飞机进行操作（这里不安全，考虑到使用非阻塞读socket来定时得到地面站信息从而防止出现bug而坠机）
起飞过程中飞机倾斜严重：飞机会自动判断，如果成立，则会自动land，同时先发送一个flag为3，再发送flag为0，以告知地面站起飞失败以让其做出合适的响应
起飞成功并变成loiter模式后:飞机会从原来的flag为1直接变为0，以告知地面站起飞成功，接受控制

***CV（机器视觉）相关***
CV这部分的flag设置类似与自动起飞，如打开该功能失败则会通过设置flag的值来告知地面站
这部分主要通过另一块Beaglebone来完成，负责对图像的采集以及分析，从视频中得到车辆位置的信息并且通过串口传送，在飞行控制板上main_mavproxy.c中的BB-UART2来进行接受，接受的指令格式有如*forward之类，然后传送给status结构从而把指令信息通过远程wifi传送给地面站予以显示，如果读取到了车牌信息，则会存入status.car_lisence中，也传送给地面站。
本部分并不涉及飞机的自动控制，只是通过飞机的机器视觉给予地面站相应的指挥策略来使飞机能载合适的位置读取到车牌信息并且回传。
当打开了CV之后，会在整个状态即的某些地方尝试读取串口，如果串口为空则跳过（非阻塞读取串口），如果读到数据则进行相应的判断。

***飞行安全机制相关***
飞机载飞行过程中加入了许多安全机制
1、起飞前参数设置
在每次程序启动开始后，都会自动执行如参数设置以及水平校准的设置，以防止出现起飞侧翻（血的教训，起飞前一定不要大意，尝试增加throttle看看飞机有没有侧翻的趋势，如果有则一定不要飞行，一定要再次重启程序或者给飞机发送level指令让其校准水平）
飞机起飞是需要解锁的（软件解锁，（在软件解锁前需要硬件解锁即长按红色的switch）软件解锁即通过将3通道打最低，4通道打最大并且维持几秒来解锁，解锁后飞机电机会低速旋转）

2、自动起飞（具体自动起飞函数在mavproxy.c中）（目前安全问题还会出现，所以一定要保证各项参数正确，测试通过再尝试自动起飞）
在该过程中，飞机会不断地检测自身的加速度以及各个角度的数据，以保证飞机在水平情况下起飞，如果在起飞过程中发现飞机倾斜过严重，则会自动切换成land的指令，保证飞机的安全；
如果载起飞后若干秒后并未打到预期高度以上，也会采取自动降落的策略，防止飞机出现安全问题；
在自动起飞中，飞机并没有与地面站进行通讯，所以这里载之后需要改进，即每隔一定的时间对socket进行非阻塞读，如果读到相应地面站紧急介入的控制指令，则停止自动起飞，转而由地面站控制飞行。

3、手动控制
为了防止误操作，我们用SAFE_CHAN12来保证1 2 通道范围值载1300 - 1700之间（但是当当前mode为LOITER时，取消这种限定）；
另外当测量当前的高度大于SAFE_DOWN_HEIGHT，则需要对最小油门做限制，当前值为1350，以防止飞行器载过高的地方下降速度过快导致坠机（需要注意的是SAFE_DOWN_HEIGHT不能设置得过低，否则因为目前气压计的不准确，导致可能即使在地面也会出现某些时刻测量的高度大于SAFE_DOWN_HEIGHT的情况，此时会出现油门一下拉高，飞机侧翻的危险情况）

4、网络通讯
由于使用的wifi范围小，可能出现wifi失联的情况，这时候我们设置了尝试重连失败次数大于50（大概差不多1秒内把），则认为无法链接，则自动land。

5、安全参数的设置
这需要参考黄奇伟文件里面的pixhawk参数表，里面有诸如最大飞行倾斜角，飞行栅栏（hence）的范围，长时间不收到控制指令则降落（什么参数控制记不得了）

